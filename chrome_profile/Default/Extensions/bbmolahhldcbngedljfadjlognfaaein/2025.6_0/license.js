!function(){async function p(e=null,t=null){k("loading"),await chrome.storage.local.remove(["licenseKey","licenseToken","licenseData","licensed"]);var n=await chrome.runtime.sendMessage({type:"checkLicense",key:e,token:t});"success"===n.data.status?(t?await chrome.storage.local.set({licenseToken:t}):await chrome.storage.local.set({licenseKey:e}),await chrome.storage.local.set({licenseData:n.data}),await chrome.storage.local.set({licensed:!0}),h(n.data),k("ready")):"failure"===n.data.status?(t?await chrome.storage.local.set({licenseToken:t}):await chrome.storage.local.set({licenseKey:e}),await chrome.storage.local.set({licenseData:n.data}),await chrome.storage.local.remove("licensed"),h(n.data),k("ready")):(await chrome.storage.local.remove("licensed"),document.getElementById("licenseText").textContent="Validation failed. Please check your input.",k("validate"))}function k(e){const t=document.getElementById("loading"),n=document.getElementById("licensed"),l=document.getElementById("unlicensed"),a=document.getElementById("validate");"init"===e?(t.style.display="none",n.style.display="none",l.style.display="block",a.style.display="none"):"loading"===e?(t.style.display="block",n.style.display="none",l.style.display="none",a.style.display="none"):"ready"===e?(t.style.display="none",n.style.display="block",l.style.display="none",a.style.display="none"):"validate"===e&&(t.style.display="none",n.style.display="none",l.style.display="none",a.style.display="block")}function h(e){const t=document.getElementById("ownerName"),n=document.getElementById("licenseStatus");document.getElementById("licenseType");const l=document.getElementById("statusMessage");document.getElementById("continueToApp");const a=document.getElementById("manageSubscription");l.innerHTML=function(e,t){switch(e){case"success":return"✅ &nbsp;Your license is active.";case"invalid":return"The license key or token is invalid. Please check your input.";case"offline":return"Cannot validate the license. Please check your internet connection.";case"failure":return`❌&nbsp;Your license is expired, canceled or paused.<br/> Click <a href="${t.subscriptionUrl}" target="_blank">here</a> to manage your subscription.`;default:return"Validation failed. Please check your input."}}(e.status,e),n.textContent=e.status,t.textContent=e.ownerName,e.subscriptionUrl?(a.style.display="block",a.href=e.subscriptionUrl):a.style.display="none"}document.addEventListener("DOMContentLoaded",async function(){var e=(await chrome.storage.local.get("licenseData")).licenseData;(await chrome.storage.local.get("licenseKey")).licenseKey,(await chrome.storage.local.get("licenseToken")).licenseToken,e?(k("ready"),h(e)):k("init");const t=document.getElementById("removeLicense"),n=(t.addEventListener("click",()=>{confirm("Are you sure you want to remove the license?")&&(k("loading"),chrome.storage.local.remove(["licenseKey","licenseToken","licenseData","licensed"]),chrome.runtime.sendMessage({type:"updateLicense"}),k("init"),alert("License removed successfully."))}),document.getElementById("editLicense")),r=(n.addEventListener("click",()=>{k("validate")}),document.getElementById("goBack")),y=(r.addEventListener("click",()=>{k("init")}),document.getElementById("validateLicense")),l=(y.addEventListener("click",()=>{var e=document.getElementById("licenseKeyInput").value,t=document.getElementById("licenseTokenInput").value;""!==t&&"token"===c?p(null,t):""!==e&&p(e,null),document.getElementById("licenseKeyInput").value="",document.getElementById("licenseTokenInput").value=""}),document.getElementById("help-button")),a=document.getElementById("helpTooltip"),i=(l.addEventListener("mouseenter",function(){var e=l.getBoundingClientRect();a.style.top=e.top+window.scrollY-a.offsetHeight-15+"px",a.style.left=e.left+window.scrollX+e.width/2-a.offsetWidth/2+"px",a.style.visibility="visible",a.style.opacity="1"}),l.addEventListener("mouseleave",function(){a.style.visibility="hidden",a.style.opacity="0"}),document.getElementById("licenseKeyInput")),o=document.getElementById("licenseTokenInput"),s=document.getElementById("licenseText"),u=document.getElementById("key");var c="key";u.addEventListener("click",()=>{c="key",i.style.display="inline-block",o.style.display="none",s.innerHTML="Enter your license key to activate the extension. If you don't have a license key, you can get it from <a id='licenseKeyLink' href='https://labs.leaningtech.com/payment-applet' target='_blank'>here</a>."});const m=document.getElementById("token"),g=(m.addEventListener("click",()=>{c="token",i.style.display="none",o.style.display="inline-block",s.innerHTML="Insert a license token for offline activation. A token has been provided to you if you have a valid license."}),document.querySelectorAll("#continueToApp")),d=(g.forEach(e=>{e.addEventListener("click",()=>{chrome.tabs.getCurrent(function(e){chrome.tabs.remove(e.id,function(){})})})}),document.getElementById("manageSubscription"));d.addEventListener("click",()=>{chrome.tabs.create({url:d.href})})})}();